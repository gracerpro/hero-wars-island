<!DOCTYPE html>
<html>
<head>
  <script src="./lib.js"></script>
</head>
<body>
  <script>
    const TYPE_GOLD = "gold"
    const TYPE_CONSUMABLE = "consumable"
    const TYPE_BANNER_STONE = "bannerStone"
    const TYPE_COIN = "coin"
    const TYPE_FRAGMENT_GEAR = "fragmentGear"
    const TYPE_STAR_MONEY = "starmoney" // ?

    // download lib.json file (see readme file)
    // add string "var libData = " to start of a json content
    // rename file, lib.json => lib.js

    console.log(window.libData.seasonAdventure)

    const adventureData = window.libData.seasonAdventure
    const nodes = Object.values(adventureData.level)
    //console.log(nodes);

/*
v1147, 25.07.2024 13:40

adventureData.list.4
- id: 4
- duration: 7862400 / 60 / 60 / 24 = 91 days
- map
-- cells: Array(1718) 
-- regions: Array(4)

Часть 1?
regions[0]
- condition: time > 0

Часть 2
regions[1]
- condition: time > 1721613600, time > 03.07.2024 @ 05:00:00 MSK (GTM +03:00)

Часть 1?
regions[3]
- condition: time > 1719972000, time > 03.07.2024 @ 05:00:00 MSK (GTM +03:00)

Для летнего фестиваля
regions[2]
- condition: time > 1721613600, time > 22.07.2024 @ 05:00:00 MSK (GTM +03:00)
- initLevels: Array(7)
​​​​​​​0: 146
​​​​​​​1: 148
​​​​​​​2: 130 Монета турнира стихий 2000 шт, coin, id = 18
​​​​​​​3: 166 Сундук космических артефактов 5 шт, consumable, id = 301
​​​​​​​4: 167
​​​​​​​5: 132 Древний сундук артефактов титанов 3 шт, consumable, id = 149
​​​​​​​6: 131
*/

    const seasonNodes = nodes.filter((o) => o.season === 4)
    console.log("seasonNodes", seasonNodes)

    const summerInitLevels = [130, 131, 132, 146, 148, 166, 167]
    const summerNodes = seasonNodes.filter((o) => {
      return summerInitLevels.includes(o.level)
    })
    console.log("summerInitNodes", summerNodes)

    let itemTypesMap = {}
    let nodeCoins = []
    let rewardsMap = {}
    let items = []

    let levelMap = {}

    seasonNodes.forEach((node) => {
      if (summerInitLevels.includes(node.level)) {
        console.log(node)

        // level: 167
        // шагов нет, где награды лежат? 1 монета летнего фестиваля
      }

      if (node.steps.length > 0) {
        node.steps.forEach((step) => {
          //console.log(step.cost)

          if (typeof step.cost.coin === "object") {
            nodeCoins.push(step.cost.coin)
          }

          const reward = step.reward
          //console.log("cost.reward", reward)

          for (const typeName in reward) {
            itemTypesMap[typeName] = true

            if (typeName === TYPE_STAR_MONEY) {
              console.log(reward)
            }

            if (typeName === TYPE_GOLD) {
              const count = reward[typeName]
              items.push({type: TYPE_GOLD, count})
            } else {
              const rewardCountMap = reward[typeName]
              //console.log(rewardCountMap);

              for (const id in rewardCountMap) {
                const count = parseInt(rewardCountMap[id])
                items.push({type: typeName, id: parseInt(id), count})
              }
            }
          }
        })
      }

      levelMap[node.level] = levelMap[node.level] ? levelMap[node.level] + 1 : 1
    })

    console.log("item types", Object.keys(itemTypesMap))
    console.log("coins size (nodes size?)", nodeCoins.length)
    console.log(levelMap)
    console.log("items", items)
  </script>
</body>
</html>
